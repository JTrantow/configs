#
# Encoder test illustrating problems with quad enable.
#
# Use: halcmd -f halrun_encoder_test.hal
#
loadrt hostmot2
loadrt hm2_eth board_ip="10.10.10.10" config=" num_encoders=1 num_stepgens=0" 
setp   hm2_7i92.0.watchdog.timeout_ns 5000000

loadrt threads name1=test-thread period1=1000000

addf hm2_7i92.0.read          test-thread
addf hm2_7i92.0.write         test-thread

#
# Setup signals to observe encoder counts and quad faults.
#
net encoder-quad-status <= hm2_7i92.0.encoder.00.quad-error
net encoder-quad-enable => hm2_7i92.0.encoder.00.quad-error-enable
net encoder-count       <= hm2_7i92.0.encoder.00.count

start

#
# Verify quad-error is initialized correctly. (It is.)
#
gets encoder-quad-status
gets encoder-quad-enable
gets encoder-count

#
# Now use input-a and input-b encoder pins to cause a quad error.
# looking at status,enable will show both FALSE, but when you "sets encoder-quad-enable TRUE" you will get "hm2/hm2_7i92.0: Encoder 0: quadrature count error""
# 

#
# Once the quad error occurs, you can sets enable false then true to reset the quad error.
#